<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Nexus - æ•™å¸«ä¸­æ§å°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --sidebar-bg: #1a1a1a; --main-bg: #f4f6f8; --accent: #007bff; --text-dark: #333; --text-light: #aaa; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--main-bg); }
        
        /* å´é‚Šæ¬„ */
        .sidebar { width: 250px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .brand { font-size: 1.5em; font-weight: bold; color: #00ff9d; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .menu-item { padding: 12px 15px; cursor: pointer; color: #ccc; border-radius: 6px; margin-bottom: 5px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover, .menu-item.active { background: #333; color: white; }
        .menu-item.active { border-left: 4px solid var(--accent); }

        /* ä¸»å…§å®¹å€ */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header h2 { margin: 0; color: var(--text-dark); }
        
        /* è¦–åœ–åˆ‡æ› */
        .view-section { display: none; }
        .view-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å¡ç‰‡å„€è¡¨æ¿ */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .stat-card h3 { margin: 0 0 10px 0; color: #888; font-size: 0.9em; }
        .stat-card .number { font-size: 2em; font-weight: bold; color: var(--text-dark); }
        .chart-container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); height: 300px; }

        /* èª²ç¨‹åˆ—è¡¨è¡¨æ ¼ */
        .course-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .course-table th, .course-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .course-table th { background: #fafafa; font-weight: 600; color: #555; }
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold; }
        .status-active { background: #e6fffa; color: #00b894; }
        .status-draft { background: #fff0f0; color: #ff7675; }
        .btn-sm { padding: 5px 10px; border-radius: 4px; border: 1px solid #ddd; background: white; cursor: pointer; margin-right: 5px; }
        .btn-sm:hover { background: #f0f0f0; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        
        /* ç·¨è¼¯è¡¨å–® Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: white; width: 500px; padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">ğŸš€ Code Nexus</div>
        <div class="menu-item active" onclick="switchView('dashboard')">ğŸ“Š æ•¸æ“šå„€è¡¨æ¿</div>
        <div class="menu-item" onclick="switchView('courses')">ğŸ“š èª²ç¨‹æ•™æç®¡ç†</div>
        <div class="menu-item" onclick="switchView('students')">ğŸ‘¥ å­¸ç”Ÿåå–® (é è¦½)</div>
        <div style="margin-top: auto; font-size: 0.8em; color: #666;">Ver 2.0 Pro</div>
    </div>

    <div class="main-content">
        
        <div id="view-dashboard" class="view-section active">
            <div class="header">
                <h2>ä»Šæ—¥æ¦‚æ³</h2>
                <div style="font-size:0.9em; color:#666;">2025å¹´12æœˆ15æ—¥</div>
            </div>
            <div class="dashboard-grid">
                <div class="stat-card"><h3>ç¸½å­¸ç”Ÿæ•¸</h3><div class="number">28</div></div>
                <div class="stat-card"><h3>å¹³å‡å£“åŠ›æŒ‡æ•¸</h3><div class="number" style="color:orange;">45%</div></div>
                <div class="stat-card"><h3>æœ¬é€±ç·´ç¿’å®Œæˆç‡</h3><div class="number" style="color:green;">82%</div></div>
            </div>
            <div class="chart-container">
                <canvas id="stressChart"></canvas>
            </div>
        </div>

        <div id="view-courses" class="view-section">
            <div class="header">
                <h2>æ•™æåˆ—è¡¨</h2>
                <button class="btn-primary" onclick="openModal()">+ æ–°å¢å–®å…ƒ</button>
            </div>
            <table class="course-table">
                <thead>
                    <tr>
                        <th width="50">åº</th>
                        <th>å–®å…ƒåç¨±</th>
                        <th>å½±ç‰‡ ID</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="course-list-body">
                    <tr><td colspan="5" style="text-align:center;">è¼‰å…¥ä¸­...</td></tr>
                </tbody>
            </table>
        </div>

        <div id="view-students" class="view-section">
            <div class="header"><h2>å­¸ç”Ÿåå–®</h2></div>
            <p style="color:#666;">æ­¤åŠŸèƒ½å°‡æ–¼ä¸²æ¥ä½¿ç”¨è€…ç™»å…¥ç³»çµ±å¾Œå•Ÿç”¨ã€‚</p>
        </div>

    </div>

    <div id="modal-form" class="modal-overlay">
        <div class="modal">
            <h3 id="modal-title">æ–°å¢æ•™æå–®å…ƒ</h3>
            <input type="hidden" id="edit-doc-id"> <div class="form-group">
                <label>æ’åº (Order)</label>
                <input type="number" id="inp-order" value="1">
            </div>
            <div class="form-group">
                <label>å–®å…ƒæ¨™é¡Œ</label>
                <input type="text" id="inp-title" placeholder="ä¾‹å¦‚ï¼šPython è¿´åœˆ">
            </div>
            <div class="form-group">
                <label>YouTube ID</label>
                <input type="text" id="inp-vid" placeholder="ä¾‹å¦‚ï¼šPqFKRqpHrjw">
            </div>
            <div class="form-group">
                <label>é‡é»æ‘˜è¦</label>
                <textarea id="inp-summary" style="height:80px;"></textarea>
            </div>
            <div class="form-group">
                <label>ç¯„ä¾‹ä»£ç¢¼</label>
                <textarea id="inp-code" style="height:100px; font-family:monospace;"></textarea>
            </div>
            <div class="form-group">
                <label>ç‹€æ…‹</label>
                <select id="inp-active">
                    <option value="true">ğŸŸ¢ ä¸Šæ¶ (Active)</option>
                    <option value="false">ğŸ”´ è‰ç¨¿ (Draft)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn-sm" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="saveData()">å„²å­˜</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ============================================
        // â˜…â˜…â˜… è«‹åœ¨ä¸‹æ–¹è²¼ä¸Šæ‚¨çš„ Firebase Config â˜…â˜…â˜…
        // ============================================
        const firebaseConfig = {
              apiKey: "AIzaSyBgx03WUCJhe3ymWhecEYfiyShmcy9bCkg",
              authDomain: "code-a1ef3.firebaseapp.com",
              projectId: "code-a1ef3",
              storageBucket: "code-a1ef3.firebasestorage.app",
              messagingSenderId: "733626558270",
              appId: "1:733626558270:web:6d0ffcae5a5b329b212e6f",
              measurementId: "G-547WFQWRHZ"
        };

        // åˆå§‹åŒ–
        let db;
        if (firebaseConfig.projectId !== "YOUR_PROJECT_ID") {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            loadCourses(); // å•Ÿå‹•æ™‚è¼‰å…¥åˆ—è¡¨
        } else {
            alert("è«‹å…ˆè¨­å®š Firebase Configï¼");
        }

        // === èª²ç¨‹ç®¡ç†é‚è¼¯ ===
        
        // 1. è®€å–åˆ—è¡¨
        window.loadCourses = async function() {
            const tbody = document.getElementById('course-list-body');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">è¼‰å…¥ä¸­...</td></tr>';
            
            try {
                const q = query(collection(db, "units"), orderBy("order", "asc"));
                const querySnapshot = await getDocs(q);
                tbody.innerHTML = ""; // æ¸…ç©º

                querySnapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const statusHtml = data.isActive 
                        ? `<span class="status-badge status-active">ä¸Šæ¶ä¸­</span>` 
                        : `<span class="status-badge status-draft">è‰ç¨¿</span>`;
                    
                    // æ³¨æ„ï¼šé€™è£æˆ‘å€‘æŠŠè³‡æ–™è½‰æˆ JSON å­—ä¸²å¡åœ¨æŒ‰éˆ•å±¬æ€§è£¡ï¼Œæ–¹ä¾¿ç·¨è¼¯æ™‚è®€å–
                    const dataStr = encodeURIComponent(JSON.stringify({id: docSnap.id, ...data}));

                    const row = `
                        <tr>
                            <td>${data.order}</td>
                            <td>${data.title}</td>
                            <td>${data.youtubeId}</td>
                            <td>${statusHtml}</td>
                            <td>
                                <button class="btn-sm" onclick="editCourse('${dataStr}')">âœï¸ ç·¨è¼¯</button>
                                <button class="btn-sm" style="color:red;" onclick="deleteCourse('${docSnap.id}')">ğŸ—‘ï¸ åˆªé™¤</button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (e) {
                console.error(e);
                tbody.innerHTML = '<tr><td colspan="5" style="color:red; text-align:center;">è®€å–å¤±æ•— (è«‹æª¢æŸ¥ Console)</td></tr>';
            }
        };

        // 2. å„²å­˜è³‡æ–™ (æ–°å¢æˆ–æ›´æ–°)
        window.saveData = async function() {
            const id = document.getElementById('edit-doc-id').value;
            const payload = {
                order: Number(document.getElementById('inp-order').value),
                title: document.getElementById('inp-title').value,
                youtubeId: document.getElementById('inp-vid').value,
                summary: document.getElementById('inp-summary').value,
                code: document.getElementById('inp-code').value,
                isActive: document.getElementById('inp-active').value === 'true',
                updatedAt: new Date()
            };

            const btn = document.querySelector('.modal-actions .btn-primary');
            btn.innerText = "è™•ç†ä¸­...";

            try {
                if (id) {
                    // æ›´æ–°æ¨¡å¼
                    await updateDoc(doc(db, "units", id), payload);
                } else {
                    // æ–°å¢æ¨¡å¼
                    payload.createdAt = new Date();
                    await addDoc(collection(db, "units"), payload);
                }
                closeModal();
                loadCourses(); // é‡æ–°æ•´ç†åˆ—è¡¨
            } catch (e) {
                alert("å„²å­˜å¤±æ•—ï¼š" + e.message);
            } finally {
                btn.innerText = "å„²å­˜";
            }
        };

        // 3. åˆªé™¤è³‡æ–™
        window.deleteCourse = async function(id) {
            if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹å–®å…ƒå—ï¼Ÿ")) return;
            try {
                await deleteDoc(doc(db, "units", id));
                loadCourses();
            } catch (e) {
                alert("åˆªé™¤å¤±æ•—");
            }
        };

        // === UI äº’å‹•é‚è¼¯ (æ›è¼‰åˆ° window) ===
        
        window.switchView = function(viewName) {
            // åˆ‡æ› active class
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active'); // é»æ“Šçš„è®Šäº®
            
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
        };

        window.openModal = function() {
            // é‡ç½®è¡¨å–®ç‚ºæ–°å¢æ¨¡å¼
            document.getElementById('modal-title').innerText = "æ–°å¢æ•™æå–®å…ƒ";
            document.getElementById('edit-doc-id').value = "";
            document.getElementById('inp-order').value = "1";
            document.getElementById('inp-title').value = "";
            document.getElementById('inp-vid').value = "";
            document.getElementById('inp-summary').value = "";
            document.getElementById('inp-code').value = "";
            document.getElementById('inp-active').value = "true";
            document.getElementById('modal-form').style.display = "flex";
        };

        window.editCourse = function(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            document.getElementById('modal-title').innerText = "ç·¨è¼¯æ•™æå–®å…ƒ";
            document.getElementById('edit-doc-id').value = data.id;
            document.getElementById('inp-order').value = data.order;
            document.getElementById('inp-title').value = data.title;
            document.getElementById('inp-vid').value = data.youtubeId;
            document.getElementById('inp-summary').value = data.summary;
            document.getElementById('inp-code').value = data.code;
            document.getElementById('inp-active').value = data.isActive ? "true" : "false";
            document.getElementById('modal-form').style.display = "flex";
        };

        window.closeModal = function() {
            document.getElementById('modal-form').style.display = "none";
        };

    </script>

    <script>
        // åˆå§‹åŒ– Chart.js (æ¨¡æ“¬æ•¸æ“š)
        const ctx = document.getElementById('stressChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'å¹³å‡å£“åŠ›è¶¨å‹¢',
                    data: [30, 45, 35, 60, 40, 25, 20],
                    borderColor: '#007bff',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    </script>

</body>
</html>
